<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lista de Presentes | Paulo Eduardo & Erislene</title>
    <!-- Biblioteca para gerar o QR Code -->
    <script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>
    <!-- Fontes do Google para um visual mais elegante -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        /* Estilização geral da página */
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #fdfaf6;
            color: #333;
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background-image: url('https://images.unsplash.com/photo-1523438885262-a515b116f181?auto=format&fit=crop&w=1500&q=80');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
        }
        /* Container principal */
        .container {
            background-color: rgba(255, 255, 255, 0.97);
            padding: 30px 40px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            max-width: 600px;
            width: 100%;
            text-align: center;
            border-top: 5px solid #c9b083;
        }
        .couple-photo {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            object-fit: cover;
            border: 5px solid #c9b083;
            margin-bottom: 20px;
        }
        h1 {
            font-family: 'Playfair Display', serif;
            color: #b38b4c;
            font-size: 2.5em;
            margin: 0;
        }
        h2 {
            font-family: 'Poppins', sans-serif;
            font-weight: 400;
            font-size: 1.5em;
            margin-top: 5px;
            margin-bottom: 20px;
        }
        p {
            font-size: 1em;
            line-height: 1.6;
            margin-bottom: 30px;
        }
        /* Lista de Presentes */
        #gift-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 40px;
        }
        .gift-item {
            display: flex;
            align-items: center;
            background-color: #fff;
            border: 1px solid #eee;
            border-radius: 10px;
            padding: 15px;
            text-align: left;
            transition: box-shadow 0.3s ease, transform 0.3s ease;
        }
        .gift-item:hover {
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            transform: translateY(-3px);
        }
        .gift-item img {
            width: 80px;
            height: 80px;
            object-fit: cover;
            border-radius: 8px;
            margin-right: 20px;
        }
        .gift-info {
            flex-grow: 1;
        }
        .gift-info h3 {
            margin: 0 0 5px 0;
            font-size: 1.1em;
            font-weight: 600;
        }
        .gift-info .price {
            margin: 0;
            font-size: 1.2em;
            font-weight: bold;
            color: #b38b4c;
        }
        .gift-item button {
            background-color: #b38b4c;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-size: 0.9em;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        .gift-item button:hover {
            background-color: #9c783e;
        }
        /* Seção de Valor Customizado */
        .custom-value-section h3 {
            font-weight: 400;
            margin-bottom: 15px;
        }
        .custom-value-section input {
            width: 50%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 1.1em;
            text-align: center;
            margin-bottom: 15px;
        }
        .custom-value-section button {
             padding: 12px 25px;
        }
        /* Modal do PIX */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.6);
            align-items: center;
            justify-content: center;
        }
        .modal-content {
            background-color: #fff;
            margin: auto;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 400px;
            text-align: center;
            position: relative;
            animation: fadeIn 0.5s;
        }
        @keyframes fadeIn {
            from {opacity: 0; transform: scale(0.9);}
            to {opacity: 1; transform: scale(1);}
        }
        .close-button {
            color: #aaa;
            position: absolute;
            top: 15px;
            right: 20px;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
        .close-button:hover {
            color: #333;
        }
        #qrcode-container {
            margin-top: 15px;
        }
        #qrcode {
            display: flex;
            justify-content: center;
            margin-bottom: 15px;
        }
        #pix-code {
            font-family: monospace;
            word-wrap: break-word;
            padding: 10px;
            background-color: #eee;
            border-radius: 5px;
            border: 1px solid #ddd;
            cursor: pointer;
        }
        .copy-feedback {
            font-size: 0.9em;
            color: #28a745;
            margin-top: 10px;
            display: none;
        }

    </style>
</head>
<body>

    <div class="container">
        <img src="https://images.unsplash.com/photo-1525841940151-5b1b4a9a4664?auto=format&fit=crop&w=500&q=80" alt="Foto do Casal" class="couple-photo" id="couplePhoto">
        
        <h1>Paulo Eduardo & Erislene</h1>
        <h2>Nossa Lista de Presentes</h2>
        <p>Sua presença já é o nosso maior presente! Mas se quiser ir além, criamos uma lista com a nossa cara para nos ajudar a começar a vida de casados. Agradecemos de coração por fazer parte deste momento!</p>
        
        <div id="gift-list">
            <!-- Os itens de presente serão inseridos aqui pelo JavaScript -->
        </div>

        <div class="custom-value-section">
            <hr style="border: 0; border-top: 1px solid #eee; margin: 30px 0;">
            <h3>Ou nos presenteie com outro valor</h3>
            <input type="number" id="customValue" placeholder="Ex: 50.00" step="0.01" min="1.00">
            <br>
            <button onclick="presentearValorCustomizado()">Gerar QR Code</button>
        </div>

    </div>

    <!-- Mensagem de erro de autenticação, escondida por padrão -->
    <div id="auth-error" style="display: none; background-color: #fff; padding: 20px 40px; border-radius: 15px; text-align: left; max-width: 550px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); border-top: 5px solid #d9534f;">
        <h1 style="font-family: 'Playfair Display', serif; color: #d9534f; font-size: 2em; text-align: center;">Ação Final Necessária</h1>
        <p style="font-size: 1.1em; line-height: 1.6; text-align: center; margin-bottom: 20px;">Falta apenas um passo! O login anónimo precisa de ser ativado no seu painel Firebase.</p>
        <ol style="list-style-type: decimal; list-style-position: inside; text-align: left; padding-left: 10px; font-size: 1em; line-height: 1.6;">
            <li style="margin-bottom: 10px;">
                <strong>Aceda diretamente à página correta</strong> clicando neste link:<br>
                <a href="https://console.firebase.google.com/project/casamento-paulo-erislene/authentication/providers" target="_blank" style="color: #007bff; text-decoration: underline; font-weight: bold;">Ativar Métodos de Login</a>
            </li>
            <li style="margin-bottom: 10px;">Na lista que aparecer, clique em <strong>"Anónimo"</strong>.</li>
            <li style="margin-bottom: 10px;">Ative o interruptor e clique em <strong>Guardar</strong>.</li>
        </ol>
        <p style="text-align: center; margin-top: 20px;">Depois de fazer isto, recarregue a página do seu site e tudo funcionará!</p>
    </div>

    <!-- Modal para exibir o QR Code -->
    <div id="pix-modal" class="modal">
        <div class="modal-content">
            <span class="close-button" onclick="fecharModal()">&times;</span>
            <h3>Obrigado pelo carinho!</h3>
            <p style="margin-bottom: 5px;">Você selecionou: <strong id="modal-gift-name"></strong></p>
            <p style="margin-top: 0;">Valor: <strong id="modal-gift-value"></strong></p>
            <div id="qrcode-container">
                <div id="qrcode"></div>
                <p style="margin-bottom: 5px;"><strong>Pix Copia e Cola:</strong></p>
                <div id="pix-code" onclick="copiarCodigo(this)"></div>
                <div class="copy-feedback" id="copyFeedback">Código copiado!</div>
            </div>
        </div>
    </div>
    
    <script type="module">
        // Importações do Firebase
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
        import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
        
        // Configuração do Firebase que você acabou de criar
        const firebaseConfig = {
            apiKey: "AIzaSyBRyWEHW-1nc1HntdZB26vUj8zWbZTZc7o",
            authDomain: "casamento-paulo-erislene.firebaseapp.com",
            projectId: "casamento-paulo-erislene",
            storageBucket: "casamento-paulo-erislene.firebasestorage.app",
            messagingSenderId: "499973986307",
            appId: "1:499973986307:web:13ddac45d112a199385636",
            measurementId: "G-M31VC8Q7EK"
        };
        
        // Um ID único para a sua aplicação, para não misturar com outras.
        const appId = 'casamento-paulo-erislene-2025';

        // Inicializa o Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);
        
        // Autenticação anônima para permitir escrita no banco
        signInAnonymously(auth).catch((error) => {
            console.error("Erro na autenticação anônima:", error);
            // Mostra a mensagem de erro de autenticação na página
            document.querySelector('.container').style.display = 'none';
            document.getElementById('auth-error').style.display = 'block';
        });
        
        // ##################################################################
        // #### DADOS DO PIX - EDITE SOMENTE AS 3 LINHAS ABAIXO ####
        // ##################################################################
        const pixConfig = {
            chave: "seu-email@provedor.com.br", // <-- COLOQUE QUALQUER CHAVE PIX VÁLIDA AQUI
            nome: "Paulo Eduardo S.",      // <-- NOME DO BENEFICIÁRIO (até 25 caracteres)
            cidade: "SAO PAULO"               // <-- CIDADE DO BENEFICIÁRIO (sem acentos)
        };
        // ##################################################################


        // ##################################################################
        // #### LISTA DE PRESENTES - ADICIONE OU EDITE OS ITENS AQUI ####
        // ##################################################################
        const listaDePresentes = [
            { nome: "Para o noivo pagar o barbeiro e não assustar no altar.", valor: 50.00, imagem: "https://images.pexels.com/photos/3998414/pexels-photo-3998414.jpeg?auto=compress&cs=tinysrgb&w=80&h=80&dpr=1" },
            { nome: "Para a noiva garantir o penteado dos sonhos (e não surtar no dia).", valor: 60.00, imagem: "https://images.pexels.com/photos/3014856/pexels-photo-3014856.jpeg?auto=compress&cs=tinysrgb&w=80&h=80&dpr=1" },
            { nome: "Para comprar a gravata do noivo que ainda não decidiu a cor.", valor: 70.00, imagem: "https://images.pexels.com/photos/164893/pexels-photo-164893.jpeg?auto=compress&cs=tinysrgb&w=80&h=80&dpr=1" },
            { nome: "Para garantir os docinhos que você vai comer escondido.", valor: 80.00, imagem: "https://images.pexels.com/photos/2144200/pexels-photo-2144200.jpeg?auto=compress&cs=tinysrgb&w=80&h=80&dpr=1" },
            { nome: "Para ajudar a noiva a terminar de pagar o vestido (spoiler: tá lindo!).", valor: 90.00, imagem: "https://images.pexels.com/photos/2253870/pexels-photo-2253870.jpeg?auto=compress&cs=tinysrgb&w=80&h=80&dpr=1" },
            { nome: "Para contribuir com a lua de mel (porque eles merecem fugir um pouco).", valor: 100.00, imagem: "https://images.pexels.com/photos/3823495/pexels-photo-3823495.jpeg?auto=compress&cs=tinysrgb&w=80&h=80&dpr=1" },
            { nome: "Para o casal brindar com espumante e esquecer o boleto da decoração.", valor: 120.00, imagem: "https://images.pexels.com/photos/1128797/pexels-photo-1128797.jpeg?auto=compress&cs=tinysrgb&w=80&h=80&dpr=1" },
            { nome: "Para ajudar no aluguel do salão (e não casar na praça rs).", valor: 150.00, imagem: "https://images.pexels.com/photos/169198/pexels-photo-169198.jpeg?auto=compress&cs=tinysrgb&w=80&h=80&dpr=1" },
            { nome: "Para garantir que a pista de dança tenha som (pra você dançar).", valor: 200.00, imagem: "https://images.pexels.com/photos/1105666/pexels-photo-1105666.jpeg?auto=compress&cs=tinysrgb&w=80&h=80&dpr=1" },
            { nome: "Para os noivos respirarem aliviados com mais uma conta paga!", valor: 300.00, imagem: "https://images.pexels.com/photos/3760263/pexels-photo-3760263.jpeg?auto=compress&cs=tinysrgb&w=80&h=80&dpr=1" }
        ];
        // ##################################################################
        
        const modal = document.getElementById('pix-modal');

        // Adiciona as funções ao escopo global para serem acessíveis pelo HTML
        window.selecionarPresente = (nome, valor) => {
            document.getElementById('modal-gift-name').innerText = nome;
            document.getElementById('modal-gift-value').innerText = `R$ ${valor.toFixed(2).replace('.', ',')}`;
            gerarCodigoPix(valor);
            salvarContribuicao(nome, valor);
            modal.style.display = 'flex';
        }

        window.presentearValorCustomizado = () => {
            const valorInput = document.getElementById('customValue');
            const valor = parseFloat(valorInput.value);
            if (!valor || valor < 1.00) {
                alert("Por favor, digite um valor válido (mínimo R$ 1,00).");
                valorInput.focus();
                return;
            }
            const nome = "Um presente especial (valor customizado)";
            document.getElementById('modal-gift-name').innerText = nome;
            document.getElementById('modal-gift-value').innerText = `R$ ${valor.toFixed(2).replace('.', ',')}`;
            gerarCodigoPix(valor);
            salvarContribuicao(nome, valor);
            modal.style.display = 'flex';
        }

        window.fecharModal = () => {
            modal.style.display = 'none';
        }

        window.copiarCodigo = (elemento) => {
            const codigoPix = elemento.innerText;
            navigator.clipboard.writeText(codigoPix).then(() => {
                const feedback = document.getElementById('copyFeedback');
                feedback.style.display = 'block';
                setTimeout(() => { feedback.style.display = 'none'; }, 2000);
            });
        }

        // Função para salvar a contribuição no Firestore
        async function salvarContribuicao(nome, valor) {
            try {
                const docRef = await addDoc(collection(db, `/artifacts/${appId}/public/data/presentes`), {
                    nome: nome,
                    valor: valor,
                    data: serverTimestamp() 
                });
                console.log("Contribuição salva com ID: ", docRef.id);
            } catch (e) {
                console.error("Erro ao adicionar documento: ", e);
            }
        }

        function carregarPresentes() {
            const container = document.getElementById('gift-list');
            listaDePresentes.forEach(presente => {
                const itemDiv = document.createElement('div');
                itemDiv.className = 'gift-item';
                itemDiv.innerHTML = `
                    <img src="${presente.imagem}" alt="${presente.nome}">
                    <div class="gift-info">
                        <h3>${presente.nome}</h3>
                        <p class="price">R$ ${presente.valor.toFixed(2).replace('.', ',')}</p>
                    </div>
                    <button onclick="selecionarPresente('${presente.nome.replace(/'/g, "\\'")}', ${presente.valor})">Presentear</button>
                `;
                container.appendChild(itemDiv);
            });
        }

        function gerarPayload(chave, nome, cidade, valor) {
            cidade = cidade.toUpperCase().replace(/[^A-Z ]/g, '').substring(0, 15);
            nome = nome.substring(0, 25);
            valor = parseFloat(valor).toFixed(2);
            const id = (id, val) => id + String(val.length).padStart(2, '0') + val;
            let payload = '000201' + id('26', '0014br.gov.bcb.pix' + id('01', chave)) + '52040000' + '5303986' + id('54', valor) + '5802BR' + id('59', nome) + id('60', cidade) + '62070503***' + '6304';
            return payload + calcularCRC16(payload);
        }

        function calcularCRC16(payload) {
            let crc = 0xFFFF;
            for (let i = 0; i < payload.length; i++) {
                crc ^= payload.charCodeAt(i) << 8;
                for (let j = 0; j < 8; j++) {
                    crc = (crc & 0x8000) ? (crc << 1) ^ 0x1021 : crc << 1;
                }
            }
            return crc.toString(16).toUpperCase().padStart(4, '0');
        }
        
        function gerarCodigoPix(valor) {
            const payload = gerarPayload(pixConfig.chave, pixConfig.nome, pixConfig.cidade, valor);
            document.getElementById('qrcode').innerHTML = ""; 
            new QRCode(document.getElementById('qrcode'), { text: payload, width: 200, height: 200 });
            document.getElementById('pix-code').innerText = payload;
        }
        
        window.onload = carregarPresentes;
        window.onclick = function(event) {
            if (event.target == modal) {
                fecharModal();
            }
        }
    </script>
</body>
</html>


